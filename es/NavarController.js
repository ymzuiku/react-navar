"use strict";exports.__esModule=!0;var React=require("react"),navarManager_1=require("./navarManager"),utils_1=require("./utils"),initNavarControllerLock=!1;exports.NavarController=function(a){var t=a.defaultPath,r=a.children;initNavarControllerLock||(initNavarControllerLock=!0,navarManager_1.navarManager.state.historys[0].path=t);var e=React.useState(navarManager_1.navarManager.state),n=e[0],s=e[1],u=React.useRef({startTime:0,touchStarting:!1,touchMoving:!1,startX:0,startY:0,moveX:0,moveY:0,endX:0,endY:0}).current;return React.useLayoutEffect(function(){navarManager_1.navarManager.setState=s},[]),React.useEffect(function(){function g(){u.touchStarting=!1,u.touchMoving=!1,u.startX=0,u.startY=0,u.moveX=0,u.moveY=0,u.endX=0,u.endY=0,u.startTime=0}function a(a){if(1!==navarManager_1.navarManager.state.historys.length){var t=utils_1.getTouchStartX(a);t<navarManager_1.navarManager.startArea&&(u.touchStarting=!0,u.startX=t,u.startY=utils_1.getTouchStartY(a),u.startTime=Date.now())}}function t(a){if(u.touchStarting){var t=utils_1.getTouchX(a),r=utils_1.getTouchY(a),e=t-u.startX,n=r-u.startY;if(!u.touchMoving&&.1<Math.abs(n)-Math.abs(e))u.touchStarting=!1;else if(e>navarManager_1.navarManager.moveThreshold&&(u.touchMoving=!0),u.touchMoving){u.moveX=t;var s=navarManager_1.navarManager.state.historys.length-1,i=navarManager_1.navarManager.state.historys[s],o=navarManager_1.navarManager.state.historys[s-1];i&&i.update&&i.update({gesturing:!0,fix:1,x:utils_1.scope(e-navarManager_1.navarManager.moveThreshold,0,1),y:0,scale:1,instant:!0}),o&&o.update&&o.update({gesturing:!0,fix:1,x:utils_1.scope((e-navarManager_1.navarManager.moveThreshold)*navarManager_1.navarManager.sinkRate-navarManager_1.navarManager.sinkRate,-navarManager_1.navarManager.sinkRate,0),y:0,scale:1,instant:!0})}}else g()}function r(a){if(u.touchStarting||u.touchMoving){var t=utils_1.getTouchX(a),r=navarManager_1.navarManager.state.historys.length-1,e=navarManager_1.navarManager.state.historys[r],n=navarManager_1.navarManager.state.historys[r-1],s=!1;.45<t-u.startX?s=!0:.15<t-u.startX&&Date.now()-u.startTime<250&&(s=!0),e&&e.update&&e.update({gesturing:!1,fix:1,x:s?1:0,y:0,scale:1,instant:!1}),n&&n.update&&n.update({gesturing:!1,fix:1,x:s?0:-navarManager_1.navarManager.sinkRate,y:0,scale:1,instant:!1}),s&&setTimeout(function(){navarManager_1.navarManager.pop(!0)},navarManager_1.navarManager.animeTime),g()}}function e(a){requestAnimationFrame?requestAnimationFrame(function(){return t(a)}):t(a)}return utils_1.addListenResture(a,e,r),function(){utils_1.removeListenResture(a,e,r)}},[]),React.createElement(navarManager_1.navarManager.ctx.Provider,{value:n},r)};